{% extends 'templates.html' %} 

{% block titulo %}Detalle CPU - {{ hostname }}{% endblock %}

{% block body_class %}dashboard-body{% endblock %} 

{% block contenido %}
<div class="boton-retroceso-container">
    <a href="{{ url_for('dispositivo.detalle_dispositivo', hostname=hostname) }}" class="boton-retroceso">
        &larr; Volver al Detalle del Dispositivo
    </a>
</div>

<header class="dashboard-header">
    DETALLE AVANZADO DE HARDWARE - {{ hostname }}
</header>

<main class="dashboard-main">
    <div class="titulo-con-riesgo">
        <h1 class="titulo-central">{{ hostname }}</h1>
        {% if latest_data and latest_data.calculated_risk_percent is not none %}
            {% set risk_class = 'risk-low' if get_risk_status(latest_data.calculated_risk_percent) == 'Bajo' else 'risk-medium' if get_risk_status(latest_data.calculated_risk_percent) == 'Medio' else 'risk-high' %}
            <div class="indicador-riesgo {{ risk_class }}">
                Riesgo Actual: {{ get_risk_status(latest_data.calculated_risk_percent) }} ({{ "%.2f"|format(latest_data.calculated_risk_percent) }}%)
            </div>
        {% else %}
            <div class="indicador-riesgo risk-na">
                Riesgo Actual: N/A
            </div>
        {% endif %}
    </div>

    {% if hardware_info.error %}
        <div class="error-message">
            <p><strong>Error al obtener detalles del hardware:</strong> {{ hardware_info.error }}</p>
            <p>Asegúrate de que el agente se está ejecutando con permisos de administrador en <strong>{{ hostname }}</strong> y ha enviado la información de hardware.</p>
        </div>
    {% else %}
        <div class="cpu-z-layout">
            <div class="cpu-z-tab">
                <h3>Procesador (CPU)</h3>
                <div class="info-group">
                    <p><strong>Nombre:</strong> {{ hardware_info.Processor.Name if hardware_info.Processor and hardware_info.Processor.Name else 'N/A' }}</p>
                    <p><strong>Fabricante:</strong> {{ hardware_info.Processor.Manufacturer if hardware_info.Processor and hardware_info.Processor.Manufacturer else 'N/A' }}</p>
                    <p><strong>Descripción:</strong> {{ hardware_info.Processor.Description if hardware_info.Processor and hardware_info.Processor.Description else 'N/A' }}</p>
                    <p><strong>Núcleos:</strong> {{ hardware_info.Processor.NumberOfCores if hardware_info.Processor and hardware_info.Processor.NumberOfCores is not none else 'N/A' }}</p>
                    <p><strong>Hilos:</strong> {{ hardware_info.Processor.NumberOfLogicalProcessors if hardware_info.Processor and hardware_info.Processor.NumberOfLogicalProcessors is not none else 'N/A' }}</p>
                    <p><strong>Arquitectura:</strong> {{ hardware_info.Processor.Architecture if hardware_info.Processor and hardware_info.Processor.Architecture else 'N/A' }}</p>
                    <p><strong>ID de Procesador:</strong> {{ hardware_info.Processor.ProcessorId if hardware_info.Processor and hardware_info.Processor.ProcessorId else 'N/A' }}</p>
                    <p><strong>Velocidad Base (MHz):</strong> {{ hardware_info.Processor.MaxClockSpeed_MHz if hardware_info.Processor and hardware_info.Processor.MaxClockSpeed_MHz is not none else 'N/A' }}</p>
                    <p><strong>Velocidad Actual (MHz):</strong> {{ hardware_info.Processor.CurrentClockSpeed_MHz if hardware_info.Processor and hardware_info.Processor.CurrentClockSpeed_MHz is not none else 'N/A' }}</p>
                    <p><strong>Familia/Modelo/Stepping:</strong> 
                        {% if hardware_info.Processor %}
                            {{ hardware_info.Processor.Family if hardware_info.Processor.Family is not none else 'N/A' }}.{{ hardware_info.Processor.Model if hardware_info.Processor.Model is not none else 'N/A' }}.{{ hardware_info.Processor.Stepping if hardware_info.Processor.Stepping is not none else 'N/A' }}
                        {% else %}
                            N/A.N/A.N/A
                        {% endif %}
                    </p>
                    <p><strong>Instrucciones:</strong> {{ hardware_info.Processor.Instructions if hardware_info.Processor and hardware_info.Processor.Instructions else 'N/A' }}</p>
                </div>
                <h4>Caché</h4>
                <div class="info-group">
                    {% if hardware_info.Processor and hardware_info.Processor.CacheDetails %}
                        {% for cache in hardware_info.Processor.CacheDetails %}
                            <p>{{ cache }}</p>
                        {% else %}
                            <p>No se pudo obtener información detallada de la caché.</p>
                        {% endfor %}
                    {% else %}
                        <p>No se pudo obtener información detallada de la caché.</p>
                    {% endif %}
                    <p><strong>L2 Caché:</strong> {{ hardware_info.Processor.L2CacheSize_KB if hardware_info.Processor and hardware_info.Processor.L2CacheSize_KB is not none else 'N/A' }} KB</p>
                    <p><strong>L3 Caché:</strong> {{ hardware_info.Processor.L3CacheSize_KB if hardware_info.Processor and hardware_info.Processor.L3CacheSize_KB is not none else 'N/A' }} KB</p>
                </div>
            </div>

            <div class="cpu-z-tab">
                <h3>Placa Madre (Mainboard)</h3>
                <div class="info-group">
                    <p><strong>Fabricante:</strong> {{ hardware_info.Mainboard.Manufacturer if hardware_info.Mainboard and hardware_info.Mainboard.Manufacturer else 'N/A' }}</p>
                    <p><strong>Modelo:</strong> {{ hardware_info.Mainboard.Model if hardware_info.Mainboard and hardware_info.Mainboard.Model else 'N/A' }}</p>
                    <p><strong>Número de Serie:</strong> {{ hardware_info.Mainboard.SerialNumber if hardware_info.Mainboard and hardware_info.Mainboard.SerialNumber else 'N/A' }}</p>
                    <p><strong>Chipset:</strong> {{ hardware_info.Mainboard.Chipset if hardware_info.Mainboard and hardware_info.Mainboard.Chipset else 'N/A' }}</p>
                    <p><strong>BIOS Fabricante:</strong> {{ hardware_info.Mainboard.BIOS_Vendor if hardware_info.Mainboard and hardware_info.Mainboard.BIOS_Vendor else 'N/A' }}</p>
                    <p><strong>BIOS Versión:</strong> {{ hardware_info.Mainboard.BIOS_Version if hardware_info.Mainboard and hardware_info.Mainboard.BIOS_Version else 'N/A' }}</p>
                    <p><strong>BIOS Fecha:</strong> {{ hardware_info.Mainboard.BIOS_Date if hardware_info.Mainboard and hardware_info.Mainboard.BIOS_Date else 'N/A' }}</p>
                </div>
            </div>

            <div class="cpu-z-tab">
                <h3>Memoria</h3>
                <div class="info-group">
                    <p><strong>Total Instalada:</strong> {{ hardware_info.Memory.Total_Installed_GB if hardware_info.Memory and hardware_info.Memory.Total_Installed_GB is not none else 'N/A' }} GB</p>
                    <p><strong>Módulos Usados:</strong> {{ hardware_info.Memory.Number_of_Memory_Modules if hardware_info.Memory and hardware_info.Memory.Number_of_Memory_Modules is not none else 'N/A' }}</p>
                    <p><strong>Tipo (Estimado):</strong> {{ hardware_info.Memory.Type if hardware_info.Memory and hardware_info.Memory.Type else 'N/A' }}</p>
                </div>
                <h4>Detalle de Módulos</h4>
                <div class="info-group">
                    {% if hardware_info.Memory and hardware_info.Memory.Details %}
                        {% for module in hardware_info.Memory.Details %}
                            <p><strong>Slot {{ module.Slot if module.Slot else 'N/A' }}:</strong> {{ module.Capacity_GB if module.Capacity_GB is not none else 'N/A' }} GB ({{ module.Speed_MHz if module.Speed_MHz is not none else 'N/A' }} MHz) - {{ module.Manufacturer if module.Manufacturer else 'N/A' }} (PN: {{ module.Part_Number if module.Part_Number else 'N/A' }})</p>
                        {% else %}
                            <p>No se pudo obtener detalle de módulos RAM.</p>
                        {% endfor %}
                    {% else %}
                        <p>No se pudo obtener detalle de módulos RAM.</p>
                    {% endif %}
                </div>
            </div>

            <div class="cpu-z-tab">
                <h3>Gráficos (GPU)</h3>
                <div class="info-group">
                    {% if hardware_info.Graphics %}
                        {% for gpu in hardware_info.Graphics %}
                            <p><strong>Nombre:</strong> {{ gpu.Name if gpu.Name else 'N/A' }}</p>
                            <p><strong>Fabricante:</strong> {{ gpu.Manufacturer if gpu.Manufacturer else 'N/A' }}</p>
                            <p><strong>Versión del Driver:</strong> {{ gpu.Driver_Version if gpu.Driver_Version else 'N/A' }}</p>
                            <p><strong>VRAM:</strong> {{ gpu.VRAM_MB if gpu.VRAM_MB is not none else 'N/A' }} MB</p>
                            <p><strong>Resolución Actual:</strong> {{ gpu.Resolution if gpu.Resolution else 'N/A' }}</p>
                            {% if not loop.last %}<hr>{% endif %}
                        {% else %}
                            <p>No se encontró información de tarjetas gráficas.</p>
                        {% endfor %}
                    {% else %}
                        <p>No se encontró información de tarjetas gráficas.</p>
                    {% endif %}
                </div>
            </div>

            <div class="cpu-z-tab">
                <h3>Almacenamiento (Discos)</h3>
                <div class="info-group">
                    {% if hardware_info.Disks %}
                        {% for disk in hardware_info.Disks %}
                            <p><strong>Modelo:</strong> {{ disk.Model if disk.Model else 'N/A' }}</p>
                            <p><strong>Número de Serie:</strong> {{ disk.SerialNumber if disk.SerialNumber else 'N/A' }}</p>
                            <p><strong>Capacidad:</strong> {{ disk.Size_GB if disk.Size_GB is not none else 'N/A' }} GB</p>
                            <p><strong>Interfaz:</strong> {{ disk.InterfaceType if disk.InterfaceType else 'N/A' }}</p>
                            {% if not loop.last %}<hr>{% endif %}
                        {% else %}
                            <p>No se encontró información de unidades de disco.</p>
                        {% endfor %}
                    {% else %}
                        <p>No se encontró información de unidades de disco.</p>
                    {% endif %}
                </div>
            </div>

            <div class="cpu-z-tab">
                <h3>Sistema Operativo</h3>
                <div class="info-group">
                    <p><strong>Nombre:</strong> {{ hardware_info.OS.Name if hardware_info.OS and hardware_info.OS.Name else 'N/A' }}</p>
                    <p><strong>Arquitectura:</strong> {{ hardware_info.OS.Architecture if hardware_info.OS and hardware_info.OS.Architecture else 'N/A' }}</p>
                    <p><strong>Versión:</strong> {{ hardware_info.OS.Version if hardware_info.OS and hardware_info.OS.Version else 'N/A' }} (Build {{ hardware_info.OS.BuildNumber if hardware_info.OS and hardware_info.OS.BuildNumber is not none else 'N/A' }})</p>
                    <p><strong>Fecha de Instalación:</strong> {{ hardware_info.OS.InstallDate if hardware_info.OS and hardware_info.OS.InstallDate else 'N/A' }}</p>
                    <p><strong>Usuario Registrado:</strong> {{ hardware_info.OS.RegisteredUser if hardware_info.OS and hardware_info.OS.RegisteredUser else 'N/A' }}</p>
                </div>
            </div>
        </div>
    {% endif %}
</main>
{% endblock %}

{% block extra_js %}
{% endblock %}